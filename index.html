<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrDeprem - Acil Durum Haritası</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* ... your existing styles ... */
    </style>
</head>
<body>
    <header>
        <h1>TrDeprem - Acil Durum Haritası</h1>
    </header>
    <nav>
        <a href="#guncel">Güncel Olaylar</a>
        <a href="#gecmis">Geçmiş Veriler</a>
        <a href="#yardim">Yardım & Destek</a>
    </nav>

    <!-- Kandilli button -->
    <div style="text-align:center; margin-bottom:10px;">
        <button onclick="fetchKandilliEarthquakes()">Kandilli Verilerini Göster</button>
    </div>

    <div class="map-container" id="map"></div>

    <!-- Earthquake list (injected below map) -->
    <div id="quake-list" style="max-width:1200px; margin: 0 auto; padding: 10px;"></div>

    <div class="info">
        <h2>Güncel Bilgiler</h2>
        <p>TrDeprem Acil Durum Merkezi'ne hoş geldiniz. Burada deprem olaylarına ilişkin güncel bilgiler ve destek kaynakları bulabilirsiniz. Acil durumlarda lütfen resmi makamlara başvurun.</p>
    </div>
    <footer>
        <p>&copy; 2025 TrDeprem - Tüm Hakları Saklıdır</p>
    </footer>
    <a href="https://www.checkdomain.net/en/company/warranties/ssl/popup/" onclick="window.open(this.href + '?host=' + window.location.host','height=600,width=560,scrollbars=yes'); return false;" class="ssl-logo">
        <img src="https://www.checkdomain.net/assets/bundles/web/app/widget/seal/img/ssl_certificate/150x150.png?20250812-112811" alt="SSL" />
    </a>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([39.9255, 32.8663], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var markerLayer = L.layerGroup().addTo(map);

        function updateQuakeListHTML(list) {
            var listDiv = document.getElementById('quake-list');
            var html = "<h3>Son Depremler</h3><ul>";
            list.forEach(item => {
                html += `<li>${item}</li>`;
            });
            html += "</ul>";
            listDiv.innerHTML = html;
        }

        function fetchEarthquakes() {
            var endDate = new Date();
            var startDate = new Date(endDate.getTime() - 7 * 24 * 60 * 60 * 1000);

            var filter = {
                "EventSearchFilterList": [
                    {"FilterType": 8, "Value": startDate.toISOString()},
                    {"FilterType": 9, "Value": endDate.toISOString()}
                ],
                "Skip": 0,
                "Take": 50,
                "SortDescriptor": {"field": "eventDate", "dir": "desc"}
            };

            fetch('https://deprem.afad.gov.tr/EventData/GetEventsByFilter', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(filter)
            })
            .then(response => response.json())
            .then(data => {
                markerLayer.clearLayers();
                var listText = [];
                data.events.forEach(event => {
                    var marker = L.marker([event.latitude, event.longitude]).bindPopup(
                        `Büyüklük: ${event.magnitude}<br>Tarih: ${event.eventDate}<br>Derinlik: ${event.depth} km`
                    );
                    markerLayer.addLayer(marker);
                    listText.push(`(${event.magnitude}) ${event.eventDate} - [${event.latitude}, ${event.longitude}]`);
                });
                updateQuakeListHTML(listText);
            })
            .catch(error => console.error('API Hatası:', error));
        }

        function fetchKandilliEarthquakes() {
            fetch('https://api.orhanaydogdu.com.tr/deprem/live')
            .then(response => response.json())
            .then(data => {
                markerLayer.clearLayers();
                var listText = [];
                data.result.forEach(event => {
                    var marker = L.marker([event.latitude, event.longitude]).bindPopup(
                        `Büyüklük: ${event.mag}<br>Tarih: ${event.date}<br>Yer: ${event.title}`
                    );
                    markerLayer.addLayer(marker);
                    listText.push(`(${event.mag}) ${event.date} - ${event.title}`);
                });
                updateQuakeListHTML(listText);
            })
            .catch(error => console.error('Kandilli API Hatası:', error));
        }

        fetchEarthquakes();
        setInterval(fetchEarthquakes, 2000);
    </script>
</body>
</html>
